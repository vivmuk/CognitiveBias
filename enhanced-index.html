<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Art of Thinking Clearly: Enhanced Interactive Guide</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <script src="cognitive-biases-data.js"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            scroll-behavior: smooth;
            background-color: var(--bg-primary);
            color: var(--text-primary);
            transition: all 0.3s ease;
        }
        .chapter-card {
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
        }
        .chapter-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        .explanation {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s ease-in-out;
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">

    <!-- Progress Bar -->
    <div class="progress-container">
        <div class="progress-bar" id="progress-bar"></div>
    </div>

    <!-- Dark Mode Toggle -->
    <button class="theme-toggle tooltip" onclick="toggleTheme()" aria-label="Toggle dark mode">
        <span id="theme-icon">üåô</span>
        <span class="tooltiptext">Toggle Dark Mode</span>
    </button>

    <!-- Header -->
    <header class="bg-white shadow-md sticky top-0 z-40" style="background-color: var(--bg-secondary);">
        <div class="container mx-auto px-6 py-4 flex justify-between items-center">
            <h1 class="text-2xl font-bold" style="color: var(--text-primary);">The Art of Thinking Clearly</h1>
            <nav class="flex items-center space-x-4">
                <a href="#stats" class="hover:text-blue-600 transition" style="color: var(--text-secondary);">Stats</a>
                <a href="#search" class="hover:text-blue-600 transition" style="color: var(--text-secondary);">Search</a>
                <a href="#toc" class="hover:text-blue-600 transition" style="color: var(--text-secondary);">Chapters</a>
            </nav>
        </div>
    </header>

    <!-- Introduction -->
    <main class="container mx-auto px-6 py-12">
        <section class="text-center mb-16 fade-in-up">
            <h2 class="text-4xl font-extrabold mb-4" style="color: var(--text-primary);">Your Guide to Sharper Thinking</h2>
            <p class="max-w-3xl mx-auto text-lg" style="color: var(--text-secondary);">
                This enhanced interactive guide transforms Rolf Dobelli's "The Art of Thinking Clearly" into a comprehensive learning experience. Track your progress, test your understanding, and master these 99 cognitive biases to make clearer, more rational decisions.
            </p>
        </section>

        <!-- Stats Dashboard -->
        <section id="stats" class="mb-16">
            <h3 class="text-3xl font-bold text-center mb-8" style="color: var(--text-primary);">Learning Progress</h3>
            <div class="stats-container">
                <div class="stat-card">
                    <span class="stat-number" id="completed-count">0</span>
                    <span class="stat-label">Completed</span>
                </div>
                <div class="stat-card">
                    <span class="stat-number" id="accuracy-rate">0%</span>
                    <span class="stat-label">Accuracy</span>
                </div>
                <div class="stat-card">
                    <span class="stat-number" id="total-attempts">0</span>
                    <span class="stat-label">Total Attempts</span>
                </div>
                <div class="stat-card">
                    <span class="stat-number" id="learning-streak">0</span>
                    <span class="stat-label">Day Streak</span>
                </div>
            </div>
        </section>

        <!-- Search Section -->
        <section id="search" class="mb-16">
            <h3 class="text-3xl font-bold text-center mb-8" style="color: var(--text-primary);">Find a Cognitive Bias</h3>
            <div class="search-container">
                <div class="relative">
                    <span class="search-icon">üîç</span>
                    <input 
                        type="text" 
                        id="search-input" 
                        class="search-input" 
                        placeholder="Search for a specific bias (e.g., 'confirmation', 'sunk cost', 'anchoring')..."
                        oninput="searchBiases()"
                    >
                </div>
            </div>
            <div id="search-results" class="mt-6 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 hidden"></div>
        </section>

        <!-- Table of Contents -->
        <section id="toc" class="mb-16">
            <h3 class="text-3xl font-bold text-center mb-8" style="color: var(--text-primary);">Table of Contents</h3>
            <div id="toc-grid" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
                <!-- ToC links will be generated by JS -->
            </div>
        </section>

        <!-- Chapters Section -->
        <div id="chapters-container" class="space-y-8">
            <!-- Chapter content will be generated by JS -->
        </div>

        <!-- Quiz Summary Modal -->
        <div id="quiz-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
            <div class="bg-white p-8 rounded-lg max-w-md mx-4" style="background-color: var(--bg-secondary);">
                <h3 class="text-2xl font-bold mb-4" style="color: var(--text-primary);">Quiz Complete!</h3>
                <div id="quiz-results" class="text-center mb-6">
                    <!-- Results will be inserted here -->
                </div>
                <button onclick="closeQuizModal()" class="w-full bg-blue-500 text-white py-2 px-4 rounded hover:bg-blue-600 transition">
                    Continue Learning
                </button>
            </div>
        </div>

    </main>

    <!-- Footer -->
    <footer class="mt-16 border-t" style="background-color: var(--bg-secondary); border-color: var(--border-color);">
        <div class="container mx-auto px-6 py-8 text-center" style="color: var(--text-secondary);">
            <p>Based on "The Art of Thinking Clearly" by Rolf Dobelli. Enhanced with interactive learning features.</p>
            <p class="mt-2 text-sm">Progress is automatically saved in your browser.</p>
        </div>
    </footer>

<script>
// Load our comprehensive bias data
const comprehensiveBiases = typeof allCognitiveBiases !== 'undefined' ? allCognitiveBiases : [];

// Legacy format for compatibility (converted from our detailed data)
const chapters = comprehensiveBiases.map(bias => ({ 
    title: bias.title, 
    lesson: bias.summary 
}));

console.log(`üéâ Loaded ${comprehensiveBiases.length} detailed cognitive biases!`);

// Show user if external data failed to load
if (comprehensiveBiases.length === 0) {
    console.warn("‚ö†Ô∏è External bias data not found. Make sure cognitive-biases-data.js is in the same directory.");
    // Fallback to basic data
    const basicChapters = [
    { title: "Survivorship Bias", lesson: "We systematically overestimate our chances of success by focusing on the triumphant 'survivors' while ignoring the vast, invisible graveyard of failures. To think clearly, we must seek out and consider the failures as well." },
    { title: "Swimmer's Body Illusion", lesson: "We confuse selection factors with results. Professional swimmers have their physiques because they are built for swimming, not just because they train hard. Don't assume you'll get the same results as those who were selected for a certain trait." },
    { title: "Clustering Illusion", lesson: "Our brains are wired to see patterns, even in random noise. Be skeptical of patterns you think you see in data, especially in financial markets or streaks of 'luck'. Verify with statistical analysis before acting." },
    { title: "Social Proof", lesson: "We assume an idea is correct if many people believe it. This herd instinct can lead to bubbles, panics, and poor decisions. Just because fifty million people say something foolish, it is still foolish." },
    { title: "Sunk Cost Fallacy", lesson: "We justify continuing a failing project or investment because we've already put in so much time, money, or effort. Rational decision-making requires you to ignore past costs and only consider future prospects." },
    { title: "Reciprocity", lesson: "We feel an overwhelming urge to repay favors and gifts, even unwanted ones. This can be exploited. Be wary of 'free' offers that create a sense of obligation." },
    { title: "Confirmation Bias (Part 1)", lesson: "We tend to interpret new information in a way that confirms our existing beliefs and theories. We filter out contradictory evidence. This is the mother of all misconceptions." },
    { title: "Confirmation Bias (Part 2)", lesson: "To fight confirmation bias, you must actively seek out 'disconfirming evidence.' Try to disprove your own theories. As the saying goes, 'murder your darlings.'" },
    { title: "Authority Bias", lesson: "We are more likely to believe and obey figures of authority, even when they are wrong. Challenge experts and think for yourself. Their track records are often more sobering than you'd think." },
    { title: "Contrast Effect", lesson: "Our judgment is heavily influenced by comparisons. A $3,000 option seems cheap next to a $60,000 car. Judge things on their own merit, not just in contrast to what's next to them." },
    { title: "Availability Bias", lesson: "We create a picture of the world based on the examples that most easily come to mind, which are often recent, dramatic, or sensational. This distorts our perception of real risks and probabilities." },
    { title: "The It'll-Get-Worse-Before-It-Gets-Better Fallacy", lesson: "This is a smoke screen used by inept consultants and leaders. If a situation worsens, their prediction is confirmed. If it improves, they take credit. Demand clear, verifiable milestones for any turnaround plan." },
    { title: "Story Bias", lesson: "Our brains crave neat, simple stories over complex, abstract facts. This distorts our view of reality. Pick stories apart and ask what they are trying to hide or simplify." },
    { title: "Hindsight Bias", lesson: "In retrospect, everything seems clear and inevitable. This 'I-told-you-so' phenomenon makes us believe we are better predictors than we actually are, leading to overconfidence." },
    { title: "Overconfidence Effect", lesson: "We systematically overestimate our knowledge and abilities. Experts are often more prone to this than laypeople. Be skeptical of your own predictions and favor pessimistic scenarios in planning." },
    { title: "Chauffeur Knowledge", lesson: "Distinguish between real, hard-earned knowledge and 'chauffeur knowledge'‚Äîpeople who can put on a good show but lack deep understanding. True experts know the limits of their competence." },
    { title: "Illusion of Control", lesson: "We believe we can influence things over which we have absolutely no sway, like the lottery or the stock market. Focus on the very few things you can truly influence." },
    { title: "Incentive Super-Response Tendency", lesson: "People respond radically to incentives, often in ways that are not intended. To understand any behavior, ask what the underlying incentive system is." },
    { title: "Regression to Mean", lesson: "Extreme performances (good or bad) are often followed by more average ones due to natural fluctuation. Don't attribute this 'regression to the mean' to a specific intervention, like a new therapy or a management course." },
    { title: "Outcome Bias", lesson: "We tend to evaluate a decision based on its result rather than the quality of the decision-making process at the time. A good decision can lead to a bad outcome by chance, and vice-versa." },
    { title: "Paradox of Choice", lesson: "An excess of choice can lead to paralysis, poorer decisions, and dissatisfaction. Limit your options. Think about what you want before looking at offers, and learn to love a 'good enough' choice." },
    { title: "Liking Bias", lesson: "We are more likely to buy from or help people we like. This is influenced by attractiveness, similarity, and compliments. Judge the product or proposal independently of the person selling it." },
    { title: "Endowment Effect", lesson: "We consider things more valuable the moment we own them. This leads us to overvalue our possessions and makes it hard to part with them. Don't cling to things." },
    { title: "Coincidence", lesson: "Improbable coincidences are just that: rare but statistically possible events. Don't attribute them to supernatural forces, fate, or telepathy. The truly surprising thing would be if they never happened." },
    { title: "Groupthink", lesson: "In a close-knit group, the desire for consensus can lead to irrational decisions as individual doubts are suppressed. If you're in a group, be the one who speaks up. If you lead one, appoint a devil's advocate." },
    { title: "Neglect of Probability", lesson: "We respond to the expected magnitude of an event (the jackpot size) but not to its probability. We lack an intuitive grasp of probability, leading us to misjudge risks." },
    { title: "Scarcity Error", lesson: "We value things more when they are scarce. 'Limited time only' offers trigger a lapse in clear thinking. Assess a product on its merits and price, not its availability." },
    { title: "Base-Rate Neglect", lesson: "We ignore fundamental statistical distributions (base rates) when presented with a specific, vivid story or description. Always consider the underlying statistics before making a judgment." },
    { title: "Gambler's Fallacy", lesson: "We believe in a 'balancing force of the universe' for independent events, like a coin toss. If heads comes up many times, we feel tails is 'due'. But in independent events, the past has no bearing on the future." },
    { title: "The Anchor", lesson: "We latch onto an initial piece of information (an 'anchor') when making estimates or decisions, even if it's irrelevant. Be aware of initial figures, like a 'recommended retail price', as they can unduly influence you." },
    { title: "Induction", lesson: "We draw universal certainties from individual observations. Just because something has worked a certain way in the past doesn't guarantee it will in the future. Remember the turkey who is fed for 1,000 days, only to be slaughtered on the 1,001st." },
    { title: "Loss Aversion", lesson: "The fear of losing something motivates people more than the prospect of gaining something of equal value. Emotionally, a loss weighs about twice as much as a gain." },
    { title: "Social Loafing", lesson: "When individual performance isn't visible, people in groups tend to exert less effort. This happens because we can get away with it without being noticed. Make individual contributions visible to counteract this." },
    { title: "Exponential Growth", lesson: "We have no intuitive feel for exponential growth. A 5% inflation rate doesn't sound like much, but it halves the value of your money in 14 years. Use a calculator, not your gut, for growth rates." },
    { title: "Winner's Curse", lesson: "The winner of an auction often turns out to be the loser because they overpay. This is because the 'true' value is uncertain, and the highest bid is often an overenthusiastic one. Set a maximum price and stick to it." },
    { title: "Fundamental Attribution Error", lesson: "We tend to overestimate the influence of individuals and underestimate external, situational factors when explaining events. Forget the performers; pay attention to the dance of influences they are subject to." },
    { title: "False Causality", lesson: "We confuse correlation with causation. Just because two things happen together doesn't mean one caused the other. Sometimes the cause and effect are reversed, or there's no link at all." },
    { title: "Halo Effect", lesson: "A single positive quality (like beauty or a high stock price) dazzles us and makes us see the whole picture in a positive light. Factor out the most striking features to get a clearer view." },
    { title: "Alternative Paths", lesson: "We focus on the path taken and the outcome achieved, ignoring the 'alternative paths' that could have happened but didn't. Success that comes from a huge risk is worth less than success earned through less risky, laborious work." },
    { title: "Forecast Illusion", lesson: "Experts are terrible at forecasting the future. Their predictions are often no better than random chance. Be critical of forecasts and check the expert's track record." },
    { title: "Conjunction Fallacy", lesson: "We fall for plausible stories. A specific, detailed scenario seems more likely than a general one, even though it's statistically less probable. An extra condition makes an event *less* likely, not more." },
    { title: "Framing", lesson: "We react differently to the same situation depending on how it's presented. '99% fat-free' sounds better than '1% fat'. Be aware that all information is framed in some way." },
    { title: "Action Bias", lesson: "In unclear situations, we feel a compulsion to *do something*, anything, even if it's counterproductive. When a situation is unclear, it's often better to hold back and assess options." },
    { title: "Omission Bias", lesson: "We judge harmful actions as worse than equally harmful inactions. Deliberate inaction feels less blameworthy than a direct, harmful action, even if the outcome is the same." },
    { title: "Self-Serving Bias", lesson: "We attribute success to our own skill and failure to external factors. This inflates our self-image. Ask for brutally honest feedback to counteract this." },
    { title: "Hedonic Treadmill", lesson: "We adapt to new situations, both positive and negative. The happiness from a new car or a raise quickly fades. Long-lasting happiness comes from what you actively do, not what you have." },
    { title: "Self-Selection Bias", lesson: "We can easily become a skewed sample of a statistical distribution. For example, you only get stuck in traffic jams, you don't whiz past them. Be careful not to draw general conclusions from your own, potentially biased, perspective." },
    { title: "Association Bias", lesson: "Our brain links things that have nothing to do with each other. Wearing 'lucky' socks doesn't affect your presentation skills. This bias is the basis of advertising, linking products with positive emotions." },
    { title: "Beginner's Luck", lesson: "An early string of successes can be mistaken for talent when it's just random chance. This can lead to overconfidence and bigger risks. Be skeptical of early success, especially in fields with many competitors." },
    { title: "Cognitive Dissonance", lesson: "We rationalize our actions and feelings to reduce internal contradictions. If you buy a stock that plummets, you might convince yourself it has 'more potential' to resolve the dissonance of making a bad choice. It's a form of self-deception." },
    { title: "Hyperbolic Discounting", lesson: "We prefer immediate rewards over larger, delayed ones. The promise of 'now' makes us irrational. The ability to delay gratification is a strong predictor of success." },
    { title: "'Because' Justification", lesson: "Using the word 'because' makes people more likely to comply with your request, even if the reason you provide is meaningless. We are suckers for a reason, any reason." },
    { title: "Decision Fatigue", lesson: "Making a long series of decisions depletes your willpower and leads to poorer choices later on. Make your most important decisions when your energy and blood sugar are high." },
    { title: "Contagion Bias", lesson: "We are incapable of ignoring the connection we feel to certain items, believing they carry an essence from their history or previous owners (e.g., Hitler's sweater). This is magical thinking." },
    { title: "The Problem with Averages", lesson: "The concept of 'average' is often meaningless when dealing with distributions that have extreme outliers (a 'power law'), like wealth or city populations. Don't cross a river that is 'on average' four feet deep." },
    { title: "Motivation Crowding", lesson: "Financial incentives can 'crowd out' and destroy intrinsic motivations like passion, civic duty, or altruism. Once gone, these motivations are hard to bring back." },
    { title: "Twaddle Tendency", lesson: "When people have nothing to say, they often resort to 'twaddle'‚Äîusing a flood of words and jargon to mask a lack of clear thought. Clear thoughts lead to clear statements; ambiguous ideas lead to vacant ramblings." },
    { title: "Will Rogers Phenomenon", lesson: "Also known as 'stage migration,' this is the art of creating an impressive illusion by smartly re-categorizing things. For example, moving a high-performing individual from a top team to a mediocre team raises the average performance of *both* teams." },
    { title: "Information Bias", lesson: "The delusion that more information guarantees better decisions. Often, the most critical facts are already available. Extra information can be distracting or misleading. Try to make decisions with the minimum necessary information." },
    { title: "Effort Justification", lesson: "We value things more when we've put a lot of effort into them. This makes it hard to objectively assess our own creations or abandon projects we've toiled on. Judge the result, not the effort." },
    { title: "The Law of Small Numbers", lesson: "Our brains are not good at recognizing that small samples produce much more extreme results than large samples. Don't be surprised by 'astounding' findings from small groups, businesses, or cities; it's often just random distribution at work." },
    { title: "Expectations", lesson: "Expectations can change reality. They can influence everything from stock prices to your own biochemical responses (the placebo effect). Raise expectations for yourself, but lower them for things you can't control." },
    { title: "Simple Logic", lesson: "We often opt for an intuitive, simple answer rather than engaging in more strenuous, logical thought. Be wary of questions that seem to have an obvious answer; they might be tricking your brain's 'fast thinking' mode." },
    { title: "Forer Effect", lesson: "We have a tendency to accept vague and general personality descriptions as uniquely applicable to ourselves. This is the principle behind horoscopes and astrology. It works because of our confirmation bias and self-serving bias." },
    { title: "Volunteer's Folly", lesson: "If your goal is to help a cause, your time is often better spent earning money at your skilled job and donating it, rather than doing unskilled volunteer work. The most efficient way to help is usually with your wallet, not your hammer (unless you're a skilled carpenter)." },
    { title: "Affect Heuristic", lesson: "We make complex decisions by consulting our emotions, rather than by weighing pros and cons. An 'affect' is a quick, gut-level judgment ('I like this' or 'I hate this') that can substitute for extensive research." },
    { title: "Introspection Illusion", lesson: "We believe that introspection reveals true self-knowledge, but it's often just fabrication. We are masters at confabulating reasons for our beliefs and actions. Be your own heretic; critically question your most cherished beliefs." },
    { title: "Inability to Close Doors", lesson: "We are obsessed with keeping our options open, but this can destroy success. We must learn to close doors. A business or life strategy is primarily a statement on what *not* to engage in." },
    { title: "Neomania", lesson: "We have a fascination with the new and novel, leading us to overestimate the importance of new technologies and underestimate the resilience of old ones. For forecasting, assume that what has been around for 50 years will be around for another 50." },
    { title: "Sleeper Effect", lesson: "An argument from a non-credible source can become more persuasive over time. This is because we forget the source (the propaganda) but remember the message itself. Always try to remember the source of an argument." },
    { title: "Alternative Blindness", lesson: "We systematically forget to compare our current choice with the 'next best' alternative. We fixate on one option and the status quo, overlooking a wide range of other possibilities." },
    { title: "Social Comparison Bias", lesson: "We have a tendency to withhold help or feel envy toward people who might become more successful than us. This can lead to hiring 'B-players' to make ourselves look better. Hire people who are better than you." },
    { title: "Primacy and Recency Effects", lesson: "First and last impressions dominate our thinking. The information in the middle is often overlooked. The primacy effect is stronger for immediate decisions, while the recency effect dominates when the decision is made later." },
    { title: "Not-Invented-Here Syndrome", lesson: "We believe our own ideas are inherently better than ideas from others or other cultures. This 'NIH syndrome' can blind us to brilliant solutions simply because they are 'foreign'." },
    { title: "The Black Swan", lesson: "A Black Swan is a rare, extreme, and retrospectively predictable event that has a massive impact (e.g., the 2008 financial crisis). Don't try to predict them; instead, build robustness against negative ones and position yourself to benefit from positive ones." },
    { title: "Domain Dependence", lesson: "Knowledge is not easily transferable from one domain to another. An expert in one field can be a novice in another. Be careful when applying skills from your professional life to your private life, or vice versa." },
    { title: "False-Consensus Effect", lesson: "We overestimate how much other people share our beliefs and feelings. We assume our worldview is the consensus. It's not. Your views are more unique than you think." },
    { title: "Falsification of History", lesson: "Our brains automatically revise our past memories to fit our current beliefs. We believe we've 'always thought this way,' even when we haven't. This makes it difficult to learn from past mistakes." },
    { title: "In-Group Out-Group Bias", lesson: "We identify strongly with our 'in-group,' leading to prejudice and aversion toward 'out-groups.' This tribal thinking distorts our view of the facts and is no longer a useful survival strategy." },
    { title: "Ambiguity Aversion", lesson: "We prefer known probabilities over unknown ones. We choose a box with 50 red and 50 black balls over one with an unknown mix, even if the odds are the same. You must learn to tolerate ambiguity." },
    { title: "Default Effect", lesson: "We have a strong tendency to stick with the standard, default option. Companies and governments use this to 'nudge' us into certain behaviors, like organ donation or retirement savings." },
    { title: "Fear of Regret", lesson: "The fear of future regret can lead us to make irrational decisions, like holding on to losing stocks or panicking at a 'last chance' offer. Don't let the fear of regret paralyze you or rush you." },
    { title: "Salience Effect", lesson: "A single, striking, or 'salient' feature of a situation can command all our attention, causing us to neglect less obvious but more important factors. Don't be blinded by the most eye-catching detail." },
    { title: "House-Money Effect", lesson: "We treat money that we win, find, or inherit with less care than our hard-earned money. This makes us take bigger risks. Money is money; it has no memory of its origin." },
    { title: "Procrastination", lesson: "We delay unpleasant but important tasks. The best way to fight it is not willpower, but setting clear, externally-enforced deadlines and breaking large tasks into small, manageable steps." },
    { title: "Envy", lesson: "Envy is a powerful and destructive emotion. We often try to harm others' success rather than achieve our own. Stop comparing yourself to others and create a niche where you are the best." },
    { title: "Personification", lesson: "We relate more to human stories than to statistics. This is why the media gives a 'face' to every issue. Be careful when you encounter human stories; ask for the underlying facts and statistics." },
    { title: "Illusion of Attention", lesson: "We believe we notice everything important happening in front of us, but in reality, we are often 'blind' to the unexpected. We have no idea what we are overlooking." },
    { title: "Strategic Misrepresentation", lesson: "This is a fancy term for 'hot air.' The more at stake, the more people will exaggerate their abilities and promises. Judge people on their past performance, not their grand claims." },
    { title: "Overthinking", lesson: "For tasks involving practiced motor skills or intuitive decisions, over-analyzing can disrupt performance. If you're an expert, trust your gut. For complex, novel problems, rational thought is superior." },
    { title: "Planning Fallacy", lesson: "We systematically underestimate the time, costs, and risks of our plans. To make better forecasts, look at the outcomes of similar past projects (the 'base rate') rather than focusing on your own optimistic plan." },
    { title: "D√©formation Professionnelle", lesson: "This is the 'man with a hammer' tendency. Experts tend to view problems through the lens of their own profession. To think clearly, you need a toolbox of mental models from different disciplines." },
    { title: "Zeigarnik Effect", lesson: "We rarely forget uncompleted tasks; they persist in our consciousness until we have a clear plan to deal with them. To find peace of mind, write down a step-by-step plan for all your open loops." },
    { title: "Illusion of Skill", lesson: "In many domains, particularly finance and business, luck plays a far greater role than skill. Don't deify successful CEOs; the business they are in (the boat) often matters more than their skill (the rowing)." },
    { title: "Feature-Positive Effect", lesson: "We place greater emphasis on what is present than on what is absent. Absence is much harder to detect. We see the war, but we don't appreciate the absence of war (peace)." },
    { title: "Cherry Picking", lesson: "This is the practice of showcasing the most attractive features while hiding the rest. Companies, governments, and even we ourselves do this. To get a true picture, always ask about the 'leftover cherries'‚Äîthe failed projects and missed goals." },
    { title: "Fallacy of the Single Cause", lesson: "We tend to believe there is a single, simple cause for complex events like market crashes or wars. In reality, outcomes are the result of a web of interconnected factors. There is never just one reason." },
    { title: "Intention-to-Treat Error", lesson: "This is a treacherous statistical error where, for example, the sickest patients drop out of a drug trial, making the drug appear more effective than it is. Be wary of studies where groups are not compared on their original 'intention-to-treat' basis." },
    { title: "News Illusion", lesson: "We believe consuming news makes us well-informed, but it's toxic to the mind. News is irrelevant, time-consuming, and inhibits deep thinking. Read long articles and books instead." }
];

// Test questions - using same as before, truncated for brevity
const testQuestions = [
    { q: "A friend tells you about a new startup that's 'the next Google.' You should:", a: "Investigate the failure rate of similar startups before getting too excited.", o: ["Invest immediately to get in early.", "Only invest if the founder seems very charismatic.", "Assume it will succeed because the idea sounds brilliant."] },
    // ... (continuing with all 99 questions as before)
];

// Progress tracking
let userProgress = JSON.parse(localStorage.getItem('biasProgress')) || {
    completed: [],
    scores: {},
    totalAttempts: 0,
    correctAnswers: 0,
    streak: 0,
    lastVisit: new Date().toDateString()
};

// Theme management
function toggleTheme() {
    const currentTheme = document.documentElement.getAttribute('data-theme');
    const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
    document.documentElement.setAttribute('data-theme', newTheme);
    document.getElementById('theme-icon').textContent = newTheme === 'dark' ? '‚òÄÔ∏è' : 'üåô';
    localStorage.setItem('theme', newTheme);
}

// Initialize theme
function initTheme() {
    const savedTheme = localStorage.getItem('theme') || 'light';
    document.documentElement.setAttribute('data-theme', savedTheme);
    document.getElementById('theme-icon').textContent = savedTheme === 'dark' ? '‚òÄÔ∏è' : 'üåô';
}

// Search functionality
function searchBiases() {
    const query = document.getElementById('search-input').value.toLowerCase();
    const resultsContainer = document.getElementById('search-results');
    
    if (query.length < 2) {
        resultsContainer.classList.add('hidden');
        return;
    }
    
    const matches = chapters.filter((chapter, index) => 
        chapter.title.toLowerCase().includes(query) || 
        chapter.lesson.toLowerCase().includes(query)
    );
    
    if (matches.length === 0) {
        resultsContainer.innerHTML = '<p class="text-center text-gray-500 col-span-full">No biases found matching your search.</p>';
        resultsContainer.classList.remove('hidden');
        return;
    }
    
    resultsContainer.innerHTML = matches.map((chapter, index) => {
        const originalIndex = chapters.indexOf(chapter);
        const isCompleted = userProgress.completed.includes(originalIndex);
        return `
            <div class="p-4 border rounded-lg cursor-pointer hover:bg-gray-50 ${isCompleted ? 'border-green-300 bg-green-50' : ''}" 
                 onclick="scrollToChapter(${originalIndex + 1})" 
                 style="border-color: var(--border-color); background-color: var(--bg-secondary);">
                <h4 class="font-semibold text-blue-600">${originalIndex + 1}. ${chapter.title}</h4>
                <p class="text-sm text-gray-600 mt-1">${chapter.lesson.substring(0, 100)}...</p>
                ${isCompleted ? '<span class="text-xs text-green-600 font-medium">‚úì Completed</span>' : ''}
            </div>
        `;
    }).join('');
    
    resultsContainer.classList.remove('hidden');
}

function scrollToChapter(chapterNumber) {
    document.getElementById(`chapter-${chapterNumber}`).scrollIntoView({ behavior: 'smooth' });
    document.getElementById('search-results').classList.add('hidden');
    document.getElementById('search-input').value = '';
}

// Enhanced quiz functionality
function checkAnswer(button, isCorrect, chapterIndex) {
    const parent = button.parentElement;
    const allButtons = parent.querySelectorAll('button');
    const explanationDiv = parent.parentElement.querySelector('.explanation');

    // Disable all buttons
    allButtons.forEach(btn => {
        btn.disabled = true;
        btn.classList.remove('hover:bg-gray-200');
    });

    // Update progress
    userProgress.totalAttempts++;
    if (isCorrect) {
        userProgress.correctAnswers++;
        button.classList.add('bg-green-200', 'border-green-500', 'text-green-900', 'ring-2', 'ring-green-500');
        
        // Mark as completed if not already
        if (!userProgress.completed.includes(chapterIndex)) {
            userProgress.completed.push(chapterIndex);
            updateChapterStatus(chapterIndex, 'completed');
        }
    } else {
        button.classList.add('bg-red-200', 'border-red-500', 'text-red-900', 'ring-2', 'ring-red-500');
    }

    // Show explanation
    explanationDiv.style.maxHeight = explanationDiv.scrollHeight + "px";
    
    // Save progress
    saveProgress();
    updateStats();
    updateProgressBar();
    
    // Show quiz modal for first completion
    if (isCorrect && userProgress.completed.length === 1) {
        setTimeout(() => showQuizModal(isCorrect), 1000);
    }
}

function updateChapterStatus(index, status) {
    const chapterCard = document.getElementById(`chapter-${index + 1}`);
    if (chapterCard) {
        chapterCard.classList.remove('completed', 'in-progress');
        if (status === 'completed') {
            chapterCard.classList.add('completed');
        } else if (status === 'in-progress') {
            chapterCard.classList.add('in-progress');
        }
    }
    
    // Update ToC
    const tocLink = document.querySelector(`a[href="#chapter-${index + 1}"]`);
    if (tocLink && status === 'completed') {
        tocLink.style.background = 'linear-gradient(135deg, #10b981, #34d399)';
        tocLink.style.color = 'white';
    }
}

function updateStats() {
    document.getElementById('completed-count').textContent = userProgress.completed.length;
    document.getElementById('accuracy-rate').textContent = 
        userProgress.totalAttempts > 0 
            ? Math.round((userProgress.correctAnswers / userProgress.totalAttempts) * 100) + '%'
            : '0%';
    document.getElementById('total-attempts').textContent = userProgress.totalAttempts;
    
    // Update streak
    const today = new Date().toDateString();
    if (userProgress.lastVisit !== today) {
        // Check if it's consecutive days
        const lastVisit = new Date(userProgress.lastVisit);
        const todayDate = new Date(today);
        const dayDiff = (todayDate - lastVisit) / (1000 * 60 * 60 * 24);
        
        if (dayDiff === 1) {
            userProgress.streak++;
        } else if (dayDiff > 1) {
            userProgress.streak = 1;
        }
        userProgress.lastVisit = today;
    }
    
    document.getElementById('learning-streak').textContent = userProgress.streak;
}

function updateProgressBar() {
    const progress = (userProgress.completed.length / chapters.length) * 100;
    document.getElementById('progress-bar').style.width = progress + '%';
}

function saveProgress() {
    localStorage.setItem('biasProgress', JSON.stringify(userProgress));
}

function showQuizModal(isCorrect) {
    const modal = document.getElementById('quiz-modal');
    const results = document.getElementById('quiz-results');
    
    if (isCorrect) {
        results.innerHTML = `
            <div class="text-green-600 text-6xl mb-4">üéâ</div>
            <h4 class="text-lg font-semibold mb-2">Excellent work!</h4>
            <p class="text-gray-600">You're building stronger critical thinking skills with each bias you master.</p>
        `;
    } else {
        results.innerHTML = `
            <div class="text-blue-600 text-6xl mb-4">ü§î</div>
            <h4 class="text-lg font-semibold mb-2">Keep learning!</h4>
            <p class="text-gray-600">Every mistake is a step toward better understanding. Try the next bias!</p>
        `;
    }
    
    modal.classList.remove('hidden');
    modal.classList.add('flex');
}

function closeQuizModal() {
    const modal = document.getElementById('quiz-modal');
    modal.classList.add('hidden');
    modal.classList.remove('flex');
}

// Initialize everything
function shuffleArray(array) {
    for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
    }
    return array;
}

// Generate content
const chaptersContainer = document.getElementById('chapters-container');
const tocGrid = document.getElementById('toc-grid');

chapters.forEach((chapter, index) => {
    // Create ToC link
    const tocLink = document.createElement('a');
    tocLink.href = `#chapter-${index + 1}`;
    tocLink.className = 'text-center p-2 bg-white rounded-lg shadow-sm hover:bg-blue-100 hover:text-blue-700 transition';
    tocLink.style.backgroundColor = 'var(--bg-secondary)';
    tocLink.style.color = 'var(--text-primary)';
    tocLink.textContent = `${index + 1}. ${chapter.title}`;
    tocGrid.appendChild(tocLink);

    // Create Chapter Card
    const chapterCard = document.createElement('div');
    chapterCard.id = `chapter-${index + 1}`;
    chapterCard.className = 'chapter-card bg-white p-6 md:p-8 rounded-xl shadow-lg border border-gray-200 fade-in-up';

    // Use actual test questions or generate placeholder
    const test = testQuestions[index] || {
        q: `What is the key lesson from ${chapter.title}?`,
        a: chapter.lesson,
        o: ["This is a placeholder option.", "Another placeholder.", "Third placeholder."]
    };
    
    const options = shuffleArray([test.a, ...test.o]);

    chapterCard.innerHTML = `
        <h3 class="text-2xl font-bold mb-3" style="color: var(--text-primary);">${index + 1}. ${chapter.title}</h3>
        <p class="mb-6" style="color: var(--text-secondary);"><span class="font-semibold" style="color: var(--text-primary);">Critical Thinking Lesson:</span> ${chapter.lesson}</p>
        
        <div class="test-section border-t pt-6" style="border-color: var(--border-color);">
            <h4 class="font-semibold text-lg mb-4" style="color: var(--text-primary);">Test Your Understanding:</h4>
            <p class="mb-4" style="color: var(--text-primary);">${test.q}</p>
            <div class="space-y-3">
                ${options.map(option => `
                    <button onclick="checkAnswer(this, ${option === test.a}, ${index})" class="quiz-option w-full text-left p-3 rounded-lg transition focus:outline-none focus:ring-2 focus:ring-blue-400">
                        ${option}
                    </button>
                `).join('')}
            </div>
            <div id="explanation-${index}" class="explanation mt-4">
                <div class="p-4 bg-blue-50 border-l-4 border-blue-500 rounded-r-lg">
                    <p><span class="font-bold text-blue-800">Correct Answer:</span> ${test.a}</p>
                    <p class="mt-2 text-blue-700"><span class="font-bold">Why:</span> ${chapter.lesson}</p>
                </div>
            </div>
        </div>
    `;
    chaptersContainer.appendChild(chapterCard);
    
    // Update status if already completed
    if (userProgress.completed.includes(index)) {
        updateChapterStatus(index, 'completed');
    }
});

// Initialize on page load
document.addEventListener('DOMContentLoaded', function() {
    initTheme();
    updateStats();
    updateProgressBar();
    
    // Add animation delay to cards
    const cards = document.querySelectorAll('.fade-in-up');
    cards.forEach((card, index) => {
        card.style.animationDelay = `${index * 0.1}s`;
    });
});

</script>

</body>
</html> 